<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Order Confirmed - HATOD</title>
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/pages.css">
  
  
  
  </head>
    <style>
        html, body {
            overflow-x: hidden;
            position: relative;
        }
        body {
            margin: 0;
            padding: 0;
        }
        .content-wrapper {
            margin-top: calc(4rem + max(2rem, env(safe-area-inset-top))); /* Push content below fixed header */
            margin-bottom: 0; /* No margin-bottom, padding-bottom on main handles spacing */
            font-size: 0.78em; /* Base font size reduction by 22% */
        }
        @media (min-width: 1024px) {
            main {
                padding-bottom: 3rem !important; /* Reset to normal padding on desktop (py-12 = 3rem) */
            }
        }
        /* Reduce font sizes */
        .content-wrapper .text-xs { font-size: calc(0.75rem * 0.78) !important; line-height: calc(1rem * 0.78) !important; }
        .content-wrapper .text-sm { font-size: calc(0.875rem * 0.78) !important; line-height: calc(1.25rem * 0.78) !important; }
        .content-wrapper .text-base { font-size: calc(1rem * 0.78) !important; line-height: calc(1.5rem * 0.78) !important; }
        .content-wrapper .text-lg { font-size: calc(1.125rem * 0.78) !important; line-height: calc(1.75rem * 0.78) !important; }
        .content-wrapper .text-xl { font-size: calc(1.25rem * 0.78) !important; line-height: calc(1.75rem * 0.78) !important; }
        .content-wrapper .text-2xl { font-size: calc(1.5rem * 0.78) !important; line-height: calc(2rem * 0.78) !important; }
        .content-wrapper .text-3xl { font-size: calc(1.875rem * 0.78) !important; line-height: calc(2.25rem * 0.78) !important; }
        /* Reduce spacing - padding */
        .content-wrapper .p-1 { padding: calc(0.25rem * 0.78) !important; }
        .content-wrapper .p-2 { padding: calc(0.5rem * 0.78) !important; }
        .content-wrapper .p-3 { padding: calc(0.75rem * 0.78) !important; }
        .content-wrapper .p-4 { padding: calc(1rem * 0.78) !important; }
        .content-wrapper .p-6 { padding: calc(1.5rem * 0.78) !important; }
        .content-wrapper .p-8 { padding: calc(2rem * 0.78) !important; }
        .content-wrapper .p-12 { padding: calc(3rem * 0.78) !important; }
        .content-wrapper .px-1 { padding-left: calc(0.25rem * 0.78) !important; padding-right: calc(0.25rem * 0.78) !important; }
        .content-wrapper .px-2 { padding-left: calc(0.5rem * 0.78) !important; padding-right: calc(0.5rem * 0.78) !important; }
        .content-wrapper .px-3 { padding-left: calc(0.75rem * 0.78) !important; padding-right: calc(0.75rem * 0.78) !important; }
        .content-wrapper .px-4 { padding-left: calc(1rem * 0.78) !important; padding-right: calc(1rem * 0.78) !important; }
        .content-wrapper .px-6 { padding-left: calc(1.5rem * 0.78) !important; padding-right: calc(1.5rem * 0.78) !important; }
        .content-wrapper .px-8 { padding-left: calc(2rem * 0.78) !important; padding-right: calc(2rem * 0.78) !important; }
        .content-wrapper .py-1 { padding-top: calc(0.25rem * 0.78) !important; padding-bottom: calc(0.25rem * 0.78) !important; }
        .content-wrapper .py-2 { padding-top: calc(0.5rem * 0.78) !important; padding-bottom: calc(0.5rem * 0.78) !important; }
        .content-wrapper .py-3 { padding-top: calc(0.75rem * 0.78) !important; padding-bottom: calc(0.75rem * 0.78) !important; }
        .content-wrapper .py-4 { padding-top: calc(1rem * 0.78) !important; padding-bottom: calc(1rem * 0.78) !important; }
        .content-wrapper .py-6 { padding-top: calc(1.5rem * 0.78) !important; padding-bottom: calc(1.5rem * 0.78) !important; }
        .content-wrapper .py-8 { padding-top: calc(2rem * 0.78) !important; padding-bottom: calc(2rem * 0.78) !important; }
        .content-wrapper .py-12 { padding-top: calc(3rem * 0.78) !important; padding-bottom: calc(3rem * 0.78) !important; }
        .content-wrapper .pt-2 { padding-top: calc(0.5rem * 0.78) !important; }
        .content-wrapper .pt-3 { padding-top: calc(0.75rem * 0.78) !important; }
        .content-wrapper .pt-4 { padding-top: calc(1rem * 0.78) !important; }
        .content-wrapper .pt-6 { padding-top: calc(1.5rem * 0.78) !important; }
        .content-wrapper .pt-8 { padding-top: calc(2rem * 0.78) !important; }
        .content-wrapper .pb-1 { padding-bottom: calc(0.25rem * 0.78) !important; }
        .content-wrapper .pb-3 { padding-bottom: calc(0.75rem * 0.78) !important; }
        .content-wrapper .pb-4 { padding-bottom: calc(1rem * 0.78) !important; }
        .content-wrapper .pb-6 { padding-bottom: calc(1.5rem * 0.78) !important; }
        .content-wrapper .pb-20 { padding-bottom: calc(5rem * 0.78) !important; }
        /* Reduce spacing - margin */
        .content-wrapper .mb-1 { margin-bottom: calc(0.25rem * 0.78) !important; }
        .content-wrapper .mb-2 { margin-bottom: calc(0.5rem * 0.78) !important; }
        .content-wrapper .mb-3 { margin-bottom: calc(0.75rem * 0.78) !important; }
        .content-wrapper .mb-4 { margin-bottom: calc(1rem * 0.78) !important; }
        .content-wrapper .mb-6 { margin-bottom: calc(1.5rem * 0.78) !important; }
        .content-wrapper .mb-8 { margin-bottom: calc(2rem * 0.78) !important; }
        .content-wrapper .mt-1 { margin-top: calc(0.25rem * 0.78) !important; }
        .content-wrapper .mt-2 { margin-top: calc(0.5rem * 0.78) !important; }
        .content-wrapper .mt-3 { margin-top: calc(0.75rem * 0.78) !important; }
        .content-wrapper .mt-4 { margin-top: calc(1rem * 0.78) !important; }
        .content-wrapper .mt-6 { margin-top: calc(1.5rem * 0.78) !important; }
        .content-wrapper .mt-8 { margin-top: calc(2rem * 0.78) !important; }
        .content-wrapper .mt-12 { margin-top: calc(3rem * 0.78) !important; }
        /* Reduce gaps */
        .content-wrapper .gap-1 { gap: calc(0.25rem * 0.78) !important; }
        .content-wrapper .gap-2 { gap: calc(0.5rem * 0.78) !important; }
        .content-wrapper .gap-3 { gap: calc(0.75rem * 0.78) !important; }
        .content-wrapper .gap-4 { gap: calc(1rem * 0.78) !important; }
        .content-wrapper .gap-6 { gap: calc(1.5rem * 0.78) !important; }
        .content-wrapper .gap-8 { gap: calc(2rem * 0.78) !important; }
        /* Reduce space-y utilities */
        .content-wrapper .space-y-1 > * + * { margin-top: calc(0.25rem * 0.78) !important; }
        .content-wrapper .space-y-2 > * + * { margin-top: calc(0.5rem * 0.78) !important; }
        .content-wrapper .space-y-3 > * + * { margin-top: calc(0.75rem * 0.78) !important; }
        .content-wrapper .space-y-4 > * + * { margin-top: calc(1rem * 0.78) !important; }
        .content-wrapper .space-y-6 > * + * { margin-top: calc(1.5rem * 0.78) !important; }
        .content-wrapper .space-y-8 > * + * { margin-top: calc(2rem * 0.78) !important; }
    </style>
<body class="bg-background min-h-screen">
    <!-- Header Navigation -->
    <header class="bg-surface shadow-card border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="../restaurants/restaurant_browse.html" class="flex items-center">
                        <img src="../../public/logos/app_logo.png" alt="HATOD Logo" class="w-10 h-10 mr-3 object-contain">
                        <h1 class="text-xl font-bold text-text-primary">HATOD</h1>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12" style="padding-bottom: calc(6rem + max(1rem, env(safe-area-inset-bottom)));">
        <div class="content-wrapper">
        <!-- Success Message -->
        <div class="text-center mb-8">
            <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-success-100 mb-6">
                <svg class="h-12 w-12 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
            </div>
            <h2 class="text-3xl font-bold text-text-primary mb-2">Order Confirmed!</h2>
            <p class="text-text-secondary text-lg">Your order has been placed successfully</p>
            <p class="text-text-secondary mt-2">Order ID: <span class="font-semibold text-text-primary">#ORD-2024-1542</span></p>
        </div>

        <!-- Order Details Card -->
        <div class="bg-surface rounded-lg p-6 shadow-card border border-border mb-6">
            <h3 class="text-lg font-semibold text-text-primary mb-4">Order Details</h3>
            
            <!-- Restaurant Info -->
            <div class="flex items-center space-x-4 mb-6 pb-6 border-b border-border">
                <img src="https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" 
                     alt="Pizza Palace" 
                     class="w-16 h-16 rounded-lg object-cover"
                     onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                <div>
                    <h4 class="font-semibold text-text-primary" id="restaurantName">Pizza Palace</h4>
                    <p class="text-sm text-text-secondary" id="restaurantAddress">123 Restaurant Street, New York, NY</p>
                    <p class="text-sm text-text-secondary" id="restaurantPhone">(555) 123-4567</p>
                </div>
            </div>

            <!-- Order Items -->
            <div class="mb-6 pb-6 border-b border-border">
                <h4 class="font-semibold text-text-primary mb-3">Items Ordered</h4>
                <div class="space-y-3">
                    <!-- Order items will be populated dynamically -->
                </div>
            </div>

            <!-- Delivery Info -->
            <div class="mb-6 pb-6 border-b border-border" id="delivery-info-section">
                <h4 class="font-semibold text-text-primary mb-3">Delivery Information</h4>
                <div class="space-y-2 text-sm">
                    <p class="text-text-secondary" id="delivery-address">
                        <span class="font-medium text-text-primary">Address:</span><br>
                        Loading...
                    </p>
                    <p class="text-text-secondary" id="delivery-time">
                        <span class="font-medium text-text-primary">Estimated Delivery:</span> 30-40 minutes
                    </p>
                </div>
            </div>

            <!-- Payment Info -->
            <div>
                <h4 class="font-semibold text-text-primary mb-3">Payment Summary</h4>
                <div class="space-y-2 text-sm mb-4" id="paymentSummary">
                    <div class="flex justify-between">
                        <span class="text-text-secondary">Subtotal</span>
                        <span class="text-text-primary" id="subtotal">₱0.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-text-secondary">Delivery fee</span>
                        <span class="text-text-primary" id="deliveryFee">₱0.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-text-secondary">Tax</span>
                        <span class="text-text-primary" id="taxAmount">₱0.00</span>
                    </div>
                    <div class="flex justify-between font-semibold text-lg pt-2 border-t border-border">
                        <span class="text-text-primary">Total to Pay</span>
                        <span class="text-text-primary" id="totalAmount">₱0.00</span>
                    </div>
                </div>
                <div class="flex items-center space-x-2 text-sm text-green-600 bg-green-50 p-3 rounded-lg">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <span class="font-medium" id="cashPaymentText">Cash on Delivery - Pay ₱0.00 to delivery rider upon arrival. Rider will show admin's GCash QR code for payment.</span>
            </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <a id="track-order-btn" href="order_tracking.html" class="bg-primary text-white py-3 px-6 rounded-lg font-semibold hover:bg-primary-600 transition-smooth btn-hover text-center">
                Track Order
            </a>
            <a href="order_history.html" class="bg-surface border border-border text-text-primary py-3 px-6 rounded-lg font-semibold hover:bg-gray-50 transition-smooth text-center">
                View Order History
            </a>
        </div>

        <!-- Continue Shopping -->
        <div class="text-center">
            <a href="../restaurants/restaurant_browse.html" class="text-primary hover:text-primary-600 transition-smooth font-medium">
                Continue Shopping →
            </a>
        </div>
        </div>
    </main>

    <!-- Mobile Navigation Bar Spacer (Fixed Footer) -->
    <div class="lg:hidden fixed bottom-0 left-0 right-0 bg-background z-30" style="height: calc(3rem + max(1rem, env(safe-area-inset-bottom)));"></div>

    <!-- Footer -->
    <footer class="bg-surface border-t border-border mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <p class="text-text-secondary text-sm">© 2025 HATOD. All Rights Reserved.</p>
                <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Privacy Policy</a>
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Terms of Service</a>
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Support</a>
                </div>
            </div>
        </div>
    </footer>
<script src="../../public/config.js"></script>
<script id="dhws-dataInjector" src="../../public/dhws-data-injector.js"></script>
<script>
    // API base URL (from config.js - automatically uses Railway URL in mobile apps)
    const API_BASE_URL = window.API_BASE_URL || 'http://localhost:4000/api';

    document.addEventListener('DOMContentLoaded', () => {
        loadOrderConfirmation();
    });

    async function loadOrderConfirmation() {
        try {
            // Get order ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');

            if (!orderId) {
                alert('Order ID is required');
                window.location.href = '../restaurants/restaurant_browse.html';
                return;
            }

            // Get auth token
            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to view order details');
                window.location.href = '../login.html';
                return;
            }

            // Fetch order details
            const response = await fetch(`${API_BASE_URL}/orders/${orderId}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) {
                throw new Error('Failed to load order details');
            }

            const result = await response.json();
            const { order, items, delivery } = result.data;

            // Update the page with real data
            updateOrderConfirmation(order, items, delivery);
            
            // Update track order button with orderId
            const trackOrderBtn = document.getElementById('track-order-btn');
            if (trackOrderBtn && orderId) {
                trackOrderBtn.href = `order_tracking.html?orderId=${orderId}`;
            }

        } catch (error) {
            console.error('Error loading order confirmation:', error);
            alert('Failed to load order details. Please try again.');
        }
    }

    const API_ORIGIN = API_BASE_URL.replace(/\/api$/, '');
    const PLACEHOLDER_IMAGE = 'https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D';

    function resolveImageUrl(url) {
        if (!url || url.trim() === '') {
            return PLACEHOLDER_IMAGE;
        }
        if (url.startsWith('http://') || url.startsWith('https://')) {
            return url;
        }
        const path = url.startsWith('/') ? url : `/${url}`;
        return `${API_ORIGIN}${path}`;
    }

    async function updateOrderConfirmation(order, items, delivery) {
        // Update order ID
        const orderIdElement = document.querySelector('p.text-text-secondary.mt-2 span');
        if (orderIdElement) {
            orderIdElement.textContent = `#${order.id.slice(-8).toUpperCase()}`;
        }

        // Update restaurant info
        const restaurantLogo = document.querySelector('img[alt="Pizza Palace"]');
        const restaurantName = document.getElementById('restaurantName');
        const restaurantAddress = document.getElementById('restaurantAddress');
        const restaurantPhone = document.getElementById('restaurantPhone');

        // Update restaurant logo
        if (restaurantLogo && order.restaurantImageUrl) {
            const resolvedImageUrl = resolveImageUrl(order.restaurantImageUrl);
            restaurantLogo.src = resolvedImageUrl;
            restaurantLogo.alt = order.restaurantName || 'Restaurant';
        }

        // Update restaurant name, address, and phone
        if (restaurantName) restaurantName.textContent = order.restaurantName || 'Restaurant';
        if (restaurantAddress) {
            restaurantAddress.textContent = order.restaurantAddress || 'Address not available';
        }
        if (restaurantPhone) {
            restaurantPhone.textContent = order.restaurantPhone || '';
            restaurantPhone.style.display = order.restaurantPhone ? 'block' : 'none';
        }

        // Update order items
        const orderItemsContainer = document.querySelector('.space-y-3');
        let itemsHtml = '';

        if (items && items.length > 0) {
            items.forEach(item => {
                const itemTotal = parseFloat(item.unitPrice || 0) * parseInt(item.quantity || 0);
                itemsHtml += `
                    <div class="flex justify-between">
                        <div>
                            <span class="text-text-primary font-medium">${item.menuItemName || 'Unknown Item'}</span>
                            <span class="text-text-secondary text-sm ml-2">x${item.quantity || 0}</span>
                        </div>
                        <span class="text-text-primary">₱${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            });
        } else {
            itemsHtml = '<div class="text-text-secondary text-sm">No items found</div>';
        }

        if (orderItemsContainer) orderItemsContainer.innerHTML = itemsHtml;

        // Update delivery address
        await updateDeliveryAddress(order);

        // Update estimated delivery time
        updateEstimatedDeliveryTime(order);

        // Update payment summary
        const subtotalElement = document.getElementById('subtotal');
        const deliveryFeeElement = document.getElementById('deliveryFee');
        const taxElement = document.getElementById('taxAmount');
        const totalElement = document.getElementById('totalAmount');
        const cashPaymentText = document.getElementById('cashPaymentText');

        if (subtotalElement) subtotalElement.textContent = `₱${parseFloat(order.subtotal || 0).toFixed(2)}`;
        if (deliveryFeeElement) deliveryFeeElement.textContent = `₱${parseFloat(order.deliveryFee || 0).toFixed(2)}`;
        if (taxElement) taxElement.textContent = `₱0.00`;
        if (totalElement) totalElement.textContent = `₱${parseFloat(order.totalAmount || 0).toFixed(2)}`;
        if (cashPaymentText) {
            cashPaymentText.textContent = `Cash on Delivery - Pay ₱${parseFloat(order.totalAmount || 0).toFixed(2)} to delivery rider upon arrival. Rider will show admin's GCash QR code for payment.`;
        }
    }

    async function updateDeliveryAddress(order) {
        const addressElement = document.getElementById('delivery-address');
        if (!addressElement) return;

        try {
            // First try to use the deliveryAddress from order
            if (order.deliveryAddress) {
                addressElement.innerHTML = `
                    <span class="font-medium text-text-primary">Address:</span><br>
                    ${order.deliveryAddress}
                `;
                return;
            }

            // If not available, fetch address details
            if (order.deliveryAddressId) {
                const token = localStorage.getItem('authToken');
                if (!token) return;

                const addressResponse = await fetch(`${API_BASE_URL}/customers/${order.customerId}/addresses/${order.deliveryAddressId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (addressResponse.ok) {
                    const addressData = await addressResponse.json();
                    const address = addressData.data;

                    if (address) {
                        const addressParts = [];
                        if (address.streetAddress) addressParts.push(address.streetAddress);
                        if (address.apartment) addressParts.push(address.apartment);
                        if (address.city) addressParts.push(address.city);
                        if (address.state) addressParts.push(address.state);
                        if (address.zipCode) addressParts.push(address.zipCode);
                        if (address.country) addressParts.push(address.country);

                        const fullAddress = addressParts.length > 0 
                            ? addressParts.join(', ')
                            : 'Address not available';

                        addressElement.innerHTML = `
                            <span class="font-medium text-text-primary">Address:</span><br>
                            ${fullAddress}
                        `;
                        return;
                    }
                }
            }

            // Fallback if no address found
            addressElement.innerHTML = `
                <span class="font-medium text-text-primary">Address:</span><br>
                Address not available
            `;
        } catch (error) {
            console.error('Error loading delivery address:', error);
            addressElement.innerHTML = `
                <span class="font-medium text-text-primary">Address:</span><br>
                Address not available
            `;
        }
    }

    function updateEstimatedDeliveryTime(order) {
        const deliveryTimeElement = document.getElementById('delivery-time');
        if (!deliveryTimeElement) return;

        if (order.estimatedDeliveryTime) {
            try {
                const deliveryDate = new Date(order.estimatedDeliveryTime);
                const now = new Date();
                const minutes = Math.round((deliveryDate - now) / (1000 * 60));
                
                if (minutes > 0) {
                    deliveryTimeElement.innerHTML = `
                        <span class="font-medium text-text-primary">Estimated Delivery:</span> ${minutes}-${minutes + 10} minutes
                    `;
                } else {
                    deliveryTimeElement.innerHTML = `
                        <span class="font-medium text-text-primary">Estimated Delivery:</span> 30-40 minutes
                    `;
                }
            } catch (error) {
                console.error('Error calculating delivery time:', error);
                deliveryTimeElement.innerHTML = `
                    <span class="font-medium text-text-primary">Estimated Delivery:</span> 30-40 minutes
                `;
            }
        } else {
            deliveryTimeElement.innerHTML = `
                <span class="font-medium text-text-primary">Estimated Delivery:</span> 30-40 minutes
            `;
        }
    }
</script>
</body>
</html>

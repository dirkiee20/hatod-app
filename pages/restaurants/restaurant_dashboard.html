<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Dashboard - HATOD</title>
    <link rel="stylesheet" href="../../css/main.css">

  
  
  </head>
<body class="bg-background min-h-screen">
    <!-- Header Navigation -->
    <header class="bg-surface shadow-card border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <img src="../../public/logos/app_logo.png" alt="HATOD Logo" class="w-10 h-10 mr-3 object-contain">
                    <h1 class="text-xl font-bold text-text-primary">HATOD</h1>
                </div>

                <!-- Navigation -->
                <nav class="hidden md:flex space-x-8">
                    <a href="restaurant_dashboard.html" class="text-primary font-medium border-b-2 border-primary pb-1">Dashboard</a>
                    <a href="restaurant_menu_management.html" class="text-text-secondary hover:text-primary transition-smooth">Menu</a>
                    <a href="restaurant_orders.html" class="text-text-secondary hover:text-primary transition-smooth">Orders</a>
                    <a href="restaurant_profile.html" class="text-text-secondary hover:text-primary transition-smooth">Account</a>
                </nav>

                <!-- User Profile -->
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="profileDropdownBtn" class="flex items-center space-x-2 text-text-secondary hover:text-primary transition-smooth">
                            <img id="headerProfileImage"
                                 src=""
                                 alt="Restaurant logo"
                                 class="w-8 h-8 rounded-full object-cover"
                                 onerror="this.src=window.DEFAULT_AVATAR_URL || `${window.API_BASE_URL?.replace('/api', '') || ''}/public/default-avatar.svg`; this.onerror=null;">
                            <span id="headerRestaurantName" class="text-sm font-medium">Loading...</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        <!-- Dropdown Menu -->
                        <div id="profileDropdown" class="absolute right-0 mt-2 w-48 bg-surface rounded-lg shadow-lg border border-border hidden z-50">
                            <div class="py-1">
                                <button id="logoutDropdownBtn" class="flex items-center w-full px-4 py-2 text-sm text-text-primary hover:bg-gray-50 transition-smooth">
                                    <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Tab Navigation -->
        <div class="mb-8">
            <div class="border-b border-border">
                <nav class="-mb-px flex space-x-8">
                    <button id="dashboardTab" class="tab-button active whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-primary text-primary">
                        Dashboard
                    </button>
                    <button id="addMenuTab" class="tab-button whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm border-transparent text-text-secondary hover:text-text-primary hover:border-border">
                        Add Menu Item
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="dashboardContent" class="tab-content">
            <!-- Page Header -->
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-text-primary mb-2">Restaurant Dashboard</h2>
                <p class="text-text-secondary">Manage your orders and track performance</p>
            </div>

            <!-- Loading State -->
            <div id="dashboardLoading" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
                <p class="mt-4 text-text-secondary">Loading dashboard data...</p>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardData" class="hidden">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Today's Orders -->
                    <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-text-secondary text-sm font-medium">Today's Orders</p>
                                <p id="todayOrders" class="text-2xl font-bold text-text-primary mt-1">0</p>
                            </div>
                            <div class="bg-primary-50 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Orders -->
                    <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-text-secondary text-sm font-medium">Pending Orders</p>
                                <p id="pendingOrders" class="text-2xl font-bold text-text-primary mt-1">0</p>
                            </div>
                            <div class="bg-warning-50 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Revenue -->
                    <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-text-secondary text-sm font-medium">Today's Revenue</p>
                                <p id="todayRevenue" class="text-2xl font-bold text-text-primary mt-1">₱0.00</p>
                            </div>
                            <div class="bg-success-50 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Total Revenue (30 days) -->
                    <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-text-secondary text-sm font-medium">Revenue (30 days)</p>
                                <p id="revenue30Days" class="text-2xl font-bold text-text-primary mt-1">₱0.00</p>
                            </div>
                            <div class="bg-secondary-50 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Status Breakdown -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Order Status Cards -->
                    <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                        <h3 class="text-lg font-semibold text-text-primary mb-4">Order Status</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-text-secondary">Confirmed</span>
                                <span id="confirmedOrders" class="font-medium text-text-primary">0</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-text-secondary">Preparing</span>
                                <span id="preparingOrders" class="font-medium text-text-primary">0</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-text-secondary">Ready</span>
                                <span id="readyOrders" class="font-medium text-text-primary">0</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-text-secondary">Completed</span>
                                <span id="completedOrders" class="font-medium text-success">0</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-text-secondary">Cancelled</span>
                                <span id="cancelledOrders" class="font-medium text-error">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Menu Items -->
                    <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                        <h3 class="text-lg font-semibold text-text-primary mb-4">Menu Items</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-text-secondary">Total Items</span>
                                <span id="totalMenuItems" class="font-medium text-text-primary">0</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-text-secondary">Available Items</span>
                                <span id="availableMenuItems" class="font-medium text-success">0</span>
                            </div>
                        </div>
                        <a href="restaurant_menu_management.html" class="mt-4 inline-block text-primary hover:text-primary-600 text-sm font-medium">
                            Manage Menu →
                        </a>
                    </div>
                </div>

                <!-- Recent Orders -->
                <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-text-primary">Recent Orders</h3>
                        <a href="restaurant_orders.html" class="text-primary hover:text-primary-600 text-sm font-medium">
                            View All →
                        </a>
                    </div>
                    <div id="recentOrdersList" class="space-y-3">
                        <!-- Recent orders will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Empty State (shown when no data) -->
            <div id="dashboardEmpty" class="hidden bg-surface rounded-lg p-12 shadow-card border border-border text-center">
                <svg class="w-16 h-16 text-text-secondary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <h3 class="text-lg font-semibold text-text-primary mb-2">Welcome to your dashboard</h3>
                <p class="text-text-secondary mb-6">Your restaurant analytics and order management will appear here once you start receiving orders.</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="restaurant_menu_management.html" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary-600 transition-smooth btn-hover inline-block">
                        Add Menu Items
                    </a>
                    <a href="restaurant_orders.html" class="border border-border text-text-primary px-6 py-3 rounded-lg hover:bg-gray-50 transition-smooth inline-block">
                        View Orders
                    </a>
                </div>
            </div>
        </div>

        <!-- Add Menu Item Tab Content -->
        <div id="addMenuContent" class="tab-content hidden">
            <!-- Page Header -->
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-text-primary mb-2">Add Menu Item</h2>
                <p class="text-text-secondary">Add a new item to your restaurant menu</p>
            </div>

            <!-- Add Menu Form -->
            <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                <form id="addMenuForm" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Left Column - Image Upload -->
                    <div class="space-y-4">
                        <h4 class="text-md font-medium text-text-primary">Item Image</h4>

                        <!-- Image Preview/Upload Area -->
                        <div class="border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary transition-colors">
                            <div id="imagePreview" class="hidden mb-4">
                                <img id="previewImg" src="" alt="Preview" class="max-w-full h-48 object-cover rounded-lg mx-auto">
                            </div>

                            <div id="uploadArea">
                                <svg class="w-12 h-12 text-text-secondary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                </svg>
                                <p class="text-text-secondary mb-2">Drag and drop an image here, or click to browse</p>
                                <input type="file"
                                       id="itemImageFile"
                                       name="itemImageFile"
                                       accept="image/*"
                                       class="hidden">
                                <button type="button"
                                        id="uploadBtn"
                                        class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-600 transition-smooth btn-hover">
                                    Choose Image
                                </button>
                            </div>
                        </div>

                        <!-- Image URL Alternative -->
                        <div class="space-y-2">
                            <label class="text-sm text-text-secondary">Or enter image URL:</label>
                            <input type="url"
                                   id="itemImageUrl"
                                   name="itemImageUrl"
                                   class="w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-smooth"
                                   placeholder="https://example.com/image.jpg">
                        </div>
                    </div>

                    <!-- Right Column - Item Information -->
                    <div class="space-y-4">
                        <h4 class="text-md font-medium text-text-primary">Item Information</h4>

                        <!-- Item Name -->
                        <div>
                            <label for="itemName" class="block text-sm font-medium text-text-primary mb-1">Item Name *</label>
                            <input type="text"
                                   id="itemName"
                                   name="itemName"
                                   required
                                   class="w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-smooth"
                                   placeholder="Enter item name">
                        </div>

                        <!-- Description -->
                        <div>
                            <label for="itemDescription" class="block text-sm font-medium text-text-primary mb-1">Description *</label>
                            <textarea id="itemDescription"
                                      name="itemDescription"
                                      rows="4"
                                      required
                                      class="w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-smooth resize-vertical"
                                      placeholder="Describe the item"></textarea>
                        </div>

                        <!-- Price and Category Row -->
                        <div class="grid grid-cols-2 gap-4">
                            <!-- Price -->
                            <div id="priceField">
                                <label for="itemPrice" class="block text-sm font-medium text-text-primary mb-1">Price *</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary">₱</span>
                                    <input type="number"
                                           id="itemPrice"
                                           name="itemPrice"
                                           step="0.01"
                                           min="0"
                                           required
                                           class="w-full pl-8 pr-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-smooth"
                                           placeholder="0.00">
                                </div>
                            </div>

                            <!-- Category -->
                            <div>
                                <label for="itemCategory" class="block text-sm font-medium text-text-primary mb-1">Category *</label>
                                <select id="itemCategory"
                                        name="itemCategory"
                                        required
                                        class="w-full px-3 py-2 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-smooth">
                                    <option value="">Select category</option>
                                    <!-- Categories will be loaded dynamically -->
                                </select>
                            </div>
                        </div>

                        <!-- Has Variants -->
                        <div class="flex items-center">
                            <input type="checkbox" id="itemHasVariants" name="hasVariants"
                                   class="h-4 w-4 text-primary focus:ring-primary border-border rounded">
                            <label for="itemHasVariants" class="ml-2 text-sm text-text-primary">This item has multiple sizes/prices (variants)</label>
                        </div>

                        <!-- Variants Section -->
                        <div id="variantsSection" class="hidden space-y-4">
                            <div class="border border-border rounded-lg p-4 bg-surface-50">
                                <h4 class="text-sm font-medium text-text-primary mb-3">Variants</h4>
                                <div id="variantsList" class="space-y-3">
                                    <!-- Variants will be added here -->
                                </div>
                                <button type="button" id="addVariantBtn" class="mt-3 text-sm text-primary hover:text-primary-600">
                                    + Add Variant
                                </button>
                            </div>
                        </div>

                        <!-- Availability -->
                        <div class="flex items-center pt-4">
                            <input type="checkbox"
                                   id="itemAvailable"
                                   name="itemAvailable"
                                   checked
                                   class="h-4 w-4 text-primary focus:ring-primary border-border rounded">
                            <label for="itemAvailable" class="ml-2 text-sm text-text-primary">
                                Available for ordering
                            </label>
                        </div>
                    </div>
                </form>

                <!-- Form Actions -->
                <div class="flex items-center justify-end space-x-3 mt-8 pt-6 border-t border-border">
                    <button id="resetBtn"
                            type="button"
                            class="px-4 py-2 text-text-secondary bg-gray-100 hover:bg-gray-200 rounded-lg transition-smooth">
                        Reset
                    </button>
                    <button id="saveBtn"
                            type="button"
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 transition-smooth btn-hover">
                        Add Item
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Bottom Tab Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-surface border-t border-border shadow-lg z-50">
        <div class="flex items-center py-2 px-2">
            <a href="restaurant_dashboard.html" class="flex flex-col items-center space-y-1 p-2 rounded-lg transition-colors active-tab flex-1 min-w-0">
                <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                <span class="text-xs font-medium text-primary truncate">Dashboard</span>
            </a>
            <a href="restaurant_menu_management.html" class="flex flex-col items-center space-y-1 p-2 rounded-lg transition-colors flex-1 min-w-0">
                <svg class="w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                <span class="text-xs font-medium text-text-secondary truncate">Menu</span>
            </a>
            <a href="restaurant_orders.html" class="flex flex-col items-center space-y-1 p-2 rounded-lg transition-colors flex-1 min-w-0">
                <svg class="w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
                <span class="text-xs font-medium text-text-secondary truncate">Orders</span>
            </a>
            <a href="restaurant_profile.html" class="flex flex-col items-center space-y-1 p-2 rounded-lg transition-colors flex-1 min-w-0">
                <svg class="w-5 h-5 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="text-xs font-medium text-text-secondary truncate">Account</span>
            </a>
        </div>
    </nav>


    <!-- Footer -->
    <footer class="bg-surface border-t border-border mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <p class="text-text-secondary text-sm">© 2025 HATOD. All Rights Reserved.</p>
                <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Privacy Policy</a>
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Terms of Service</a>
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Support</a>
                </div>
            </div>
        </div>
    </footer>
<script src="../../public/config.js"></script>
    <script>
        // API base URL (from config.js - automatically uses Railway URL in mobile apps)
    // API base URL
    const API_BASE_URL = window.API_BASE_URL || 'http://localhost:4000/api';

    // Authentication helper functions
    function getAuthToken() {
        return localStorage.getItem('authToken');
    }

    function getUserRole() {
        return localStorage.getItem('userRole');
    }

    // API helper functions
    async function apiRequest(endpoint, options = {}) {
        const token = getAuthToken();
        const defaultOptions = {
            headers: {
                'Content-Type': 'application/json',
                ...(token && { 'Authorization': `Bearer ${token}` })
            }
        };

        const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            ...defaultOptions,
            ...options,
            headers: {
                ...defaultOptions.headers,
                ...options.headers
            }
        });

        if (!response.ok) {
            const error = await response.json().catch(() => ({ message: 'Network error' }));
            throw new Error(error.message || `HTTP ${response.status}`);
        }

        return response.json();
    }

    // Get restaurant ID for current user
    async function getRestaurantId() {
        try {
            const response = await apiRequest('/restaurants/current');
            return response.data.id;
        } catch (error) {
            console.error('Error getting restaurant ID:', error);
            return null;
        }
    }

    function resolveImageUrl(url) {
        if (!url || url.trim() === '') {
            return null;
        }
        if (url.startsWith('http://') || url.startsWith('https://')) {
            return url;
        }
        const path = url.startsWith('/') ? url : `/${url}`;
        return `${API_BASE_URL.replace('/api', '')}${path}`;
    }

    // Update header with restaurant information
    async function updateHeaderProfile() {
        try {
            const restaurantId = await getRestaurantId();
            if (!restaurantId) {
                return;
            }

            const response = await apiRequest(`/restaurants/${restaurantId}`);
            const restaurant = response.data;

            // Update restaurant name
            const nameElement = document.getElementById('headerRestaurantName');
            if (nameElement) {
                nameElement.textContent = restaurant.name || 'Restaurant';
            }

            // Update profile image with restaurant logo
            const profileImage = document.getElementById('headerProfileImage');
            if (profileImage) {
                if (restaurant.imageUrl) {
                    const resolvedImageUrl = resolveImageUrl(restaurant.imageUrl);
                    if (resolvedImageUrl) {
                        profileImage.src = resolvedImageUrl;
                    } else {
                        profileImage.src = window.DEFAULT_AVATAR_URL || `${API_BASE_URL.replace('/api', '')}/public/default-avatar.svg`;
                    }
                } else {
                    profileImage.src = window.DEFAULT_AVATAR_URL || `${API_BASE_URL.replace('/api', '')}/public/default-avatar.svg`;
                }
            }
        } catch (error) {
            console.error('Error updating header profile:', error);
        }
    }

    // Load categories - always show static default categories
    // Categories will be created automatically when menu items are saved
    function loadCategories() {
        showDefaultCategories();
    }

    // Show default categories when no custom categories exist
    function showDefaultCategories() {
        const categorySelect = document.getElementById('itemCategory');
        categorySelect.innerHTML = `
            <option value="">Select category</option>
            <option value="appetizers">Appetizers</option>
            <option value="main-courses">Main Courses</option>
            <option value="pizzas">Pizzas</option>
            <option value="salads">Salads</option>
            <option value="desserts">Desserts</option>
            <option value="drinks">Drinks</option>
            <option value="sides">Sides</option>
        `;
    }

    // Convert category value to display name
    function getCategoryDisplayName(value) {
        const nameMap = {
            'appetizers': 'Appetizers',
            'main-courses': 'Main Courses',
            'pizzas': 'Pizzas',
            'salads': 'Salads',
            'desserts': 'Desserts',
            'drinks': 'Drinks',
            'sides': 'Sides'
        };
        return nameMap[value] || value;
    }

    // Variant management functions
    function toggleVariantsSection() {
        const hasVariants = document.getElementById('itemHasVariants').checked;
        const variantsSection = document.getElementById('variantsSection');
        const priceField = document.getElementById('priceField');

        const priceInput = document.getElementById('itemPrice');
        
        if (hasVariants) {
            variantsSection.classList.remove('hidden');
            priceField.classList.add('hidden'); // Hide price field when using variants
            priceInput.removeAttribute('required'); // Remove required attribute when using variants
        } else {
            variantsSection.classList.add('hidden');
            priceField.classList.remove('hidden'); // Show price field when not using variants
            priceInput.setAttribute('required', 'required'); // Add required attribute when not using variants
        }
    }

    function addVariantInput(name = '', price = '', isAvailable = true) {
        const variantsList = document.getElementById('variantsList');
        const variantDiv = document.createElement('div');
        variantDiv.className = 'flex items-center space-x-2 variant-item';
        variantDiv.innerHTML = `
            <input type="text" placeholder="Size/Name" value="${name}" class="flex-1 px-3 py-2 border border-border rounded-lg text-sm" required>
            <input type="number" placeholder="Price" value="${price}" step="0.01" min="0" class="w-24 px-3 py-2 border border-border rounded-lg text-sm" required>
            <input type="checkbox" ${isAvailable ? 'checked' : ''} class="h-4 w-4 text-primary focus:ring-primary border-border rounded">
            <button type="button" class="text-error hover:text-error-600 remove-variant">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        `;

        // Add remove event listener
        variantDiv.querySelector('.remove-variant').addEventListener('click', function() {
            variantDiv.remove();
        });

        variantsList.appendChild(variantDiv);
    }

    function collectVariantsData() {
        const variants = [];
        const variantItems = document.querySelectorAll('.variant-item');

        variantItems.forEach((item, index) => {
            const inputs = item.querySelectorAll('input');
            const name = inputs[0].value.trim();
            const price = parseFloat(inputs[1].value);
            const isAvailable = inputs[2].checked;

            if (name && !isNaN(price)) {
                variants.push({
                    name,
                    price,
                    displayOrder: index,
                    isAvailable
                });
            }
        });

        return variants;
    }

    // Load dashboard data
    async function loadDashboardData() {
        try {
            const restaurantId = await getRestaurantId();
            if (!restaurantId) {
                document.getElementById('dashboardLoading').classList.add('hidden');
                document.getElementById('dashboardEmpty').classList.remove('hidden');
                return;
            }

            const response = await apiRequest(`/restaurants/${restaurantId}/dashboard/stats`);
            const stats = response.data;

            // Update stats cards
            document.getElementById('todayOrders').textContent = stats.orders.today_orders || 0;
            document.getElementById('pendingOrders').textContent = stats.orders.pending_orders || 0;
            document.getElementById('todayRevenue').textContent = `₱${parseFloat(stats.revenue.today_revenue || 0).toFixed(2)}`;
            document.getElementById('revenue30Days').textContent = `₱${parseFloat(stats.revenue.revenue_last_30_days || 0).toFixed(2)}`;

            // Update order status breakdown
            document.getElementById('confirmedOrders').textContent = stats.orders.confirmed_orders || 0;
            document.getElementById('preparingOrders').textContent = stats.orders.preparing_orders || 0;
            document.getElementById('readyOrders').textContent = stats.orders.ready_orders || 0;
            document.getElementById('completedOrders').textContent = stats.orders.completed_orders || 0;
            document.getElementById('cancelledOrders').textContent = stats.orders.cancelled_orders || 0;

            // Update menu items
            document.getElementById('totalMenuItems').textContent = stats.menuItems.total_items || 0;
            document.getElementById('availableMenuItems').textContent = stats.menuItems.available_items || 0;

            // Render recent orders
            const recentOrdersList = document.getElementById('recentOrdersList');
            if (stats.recentOrders && stats.recentOrders.length > 0) {
                recentOrdersList.innerHTML = stats.recentOrders.map(order => {
                    const orderDate = new Date(order.createdAt);
                    const statusClass = {
                        'pending': 'bg-yellow-100 text-yellow-800',
                        'confirmed': 'bg-blue-100 text-blue-800',
                        'preparing': 'bg-purple-100 text-purple-800',
                        'ready': 'bg-indigo-100 text-indigo-800',
                        'delivered': 'bg-green-100 text-green-800',
                        'cancelled': 'bg-red-100 text-red-800'
                    }[order.status] || 'bg-gray-100 text-gray-800';

                    return `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-smooth">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3">
                                    <span class="font-medium text-text-primary">#${order.id.slice(-8).toUpperCase()}</span>
                                    <span class="px-2 py-1 text-xs rounded-full ${statusClass}">
                                        ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                                    </span>
                                </div>
                                <p class="text-sm text-text-secondary mt-1">${order.customerName || 'Customer'}</p>
                                <p class="text-xs text-text-secondary">${orderDate.toLocaleString()}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold text-text-primary">₱${order.totalAmount.toFixed(2)}</p>
                                <a href="restaurant_order_details.html?id=${order.id}" class="text-xs text-primary hover:text-primary-600">
                                    View Details →
                                </a>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                recentOrdersList.innerHTML = `
                    <div class="text-center py-8 text-text-secondary">
                        <p>No recent orders</p>
                    </div>
                `;
            }

            // Hide loading, show data
            document.getElementById('dashboardLoading').classList.add('hidden');
            document.getElementById('dashboardData').classList.remove('hidden');

        } catch (error) {
            console.error('Error loading dashboard data:', error);
            document.getElementById('dashboardLoading').classList.add('hidden');
            document.getElementById('dashboardEmpty').classList.remove('hidden');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Set default avatar initially
        const profileImage = document.getElementById('headerProfileImage');
        if (profileImage && !profileImage.src) {
            const API_ORIGIN = API_BASE_URL.replace(/\/api$/, '');
            profileImage.src = window.DEFAULT_AVATAR_URL || `${API_ORIGIN}/public/default-avatar.svg`;
        }
        
        // Update header profile
        updateHeaderProfile();
        
        // Load dashboard data
        loadDashboardData();
        
        // Check URL parameters for initial tab
        const urlParams = new URLSearchParams(window.location.search);
        const initialTab = urlParams.get('tab');

        // Tab functionality
        const dashboardTab = document.getElementById('dashboardTab');
        const addMenuTab = document.getElementById('addMenuTab');
        const dashboardContent = document.getElementById('dashboardContent');
        const addMenuContent = document.getElementById('addMenuContent');
        const tabButtons = document.querySelectorAll('.tab-button');

        function switchTab(activeTab, activeContent) {
            // Remove active class from all tabs
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('border-primary', 'text-primary');
                btn.classList.add('border-transparent', 'text-text-secondary');
            });

            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Activate selected tab
            activeTab.classList.add('active');
            activeTab.classList.remove('border-transparent', 'text-text-secondary');
            activeTab.classList.add('border-primary', 'text-primary');

            // Show selected content
            activeContent.classList.remove('hidden');
        }

        dashboardTab.addEventListener('click', function() {
            switchTab(dashboardTab, dashboardContent);
        });

        addMenuTab.addEventListener('click', function() {
            switchTab(addMenuTab, addMenuContent);
        });

        // Check if we should start on the add menu tab
        if (initialTab === 'add-menu') {
            switchTab(addMenuTab, addMenuContent);
        }

        // Form functionality
        const addMenuForm = document.getElementById('addMenuForm');
        const saveBtn = document.getElementById('saveBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Image upload functionality
        const uploadBtn = document.getElementById('uploadBtn');
        const itemImageFile = document.getElementById('itemImageFile');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const uploadArea = document.getElementById('uploadArea');

        uploadBtn.addEventListener('click', function() {
            itemImageFile.click();
        });

        itemImageFile.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    uploadArea.classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        // Reset form function
        function resetForm() {
            addMenuForm.reset();
            // Reset image preview
            imagePreview.classList.add('hidden');
            uploadArea.classList.remove('hidden');
            previewImg.src = '';
            itemImageFile.value = '';
            // Reset variants
            document.getElementById('variantsList').innerHTML = '';
            toggleVariantsSection();
        }

        // Handle form reset
        resetBtn.addEventListener('click', resetForm);

        // Variants functionality
        document.getElementById('itemHasVariants').addEventListener('change', toggleVariantsSection);
        document.getElementById('addVariantBtn').addEventListener('click', () => addVariantInput());

        // Load categories
        loadCategories();

        // Profile dropdown functionality
        const profileDropdownBtn = document.getElementById('profileDropdownBtn');
        const profileDropdown = document.getElementById('profileDropdown');

        if (profileDropdownBtn && profileDropdown) {
            // Toggle dropdown on button click
            profileDropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                profileDropdown.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!profileDropdownBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
                    profileDropdown.classList.add('hidden');
                }
            });

            // Handle logout from dropdown
            const logoutDropdownBtn = document.getElementById('logoutDropdownBtn');
            if (logoutDropdownBtn) {
                logoutDropdownBtn.addEventListener('click', function() {
                    // Clear all authentication data
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('refreshToken');
                    localStorage.removeItem('userId');
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('userName');
                    localStorage.removeItem('userRole');
                    sessionStorage.removeItem('isLoggedIn');

                    // Redirect to login page
                    window.location.href = '../login.html';
                });
            }
        }

        // Handle form submission
        saveBtn.addEventListener('click', async function() {
            if (addMenuForm.checkValidity()) {
                try {
                    // Get restaurant ID
                    const restaurantId = await getRestaurantId();
                    if (!restaurantId) {
                        alert('Unable to determine restaurant. Please try logging in again.');
                        return;
                    }

                    // Get form data
                    const formData = new FormData(addMenuForm);
                    const hasVariants = formData.get('hasVariants') === 'on';
                    const variants = hasVariants ? collectVariantsData() : [];

                    // Validate variants if hasVariants is true
                    if (hasVariants && variants.length === 0) {
                        alert('Please add at least one variant.');
                        return;
                    }

                    let categoryId = formData.get('itemCategory') || null;

                    // Handle default categories - find or create them if they don't exist
                    if (categoryId && !/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(categoryId)) {
                        // This is a default category name (like "main-courses")
                        const categoryDisplayName = getCategoryDisplayName(categoryId);
                        
                        try {
                            // First, try to find existing category by fetching menu
                            const menuResponse = await apiRequest(`/restaurants/${restaurantId}/menu`);
                            const existingCategories = menuResponse.data || [];
                            const existingCategory = existingCategories.find(cat => 
                                cat.name && cat.name.toLowerCase() === categoryDisplayName.toLowerCase()
                            );
                            
                            if (existingCategory && existingCategory.id) {
                                // Category already exists, use its ID
                                categoryId = existingCategory.id;
                            } else {
                                // Category doesn't exist, create it
                                const categoryResponse = await apiRequest(`/restaurants/${restaurantId}/menu/categories`, {
                                    method: 'POST',
                                    body: JSON.stringify({
                                        name: categoryDisplayName,
                                        description: null
                                    })
                                });
                                categoryId = categoryResponse.data.id;
                            }
                        } catch (error) {
                            console.error('Error handling category:', error);
                            alert('Failed to handle category. Please try again.');
                            return;
                        }
                    }

                    // Handle image upload - upload file if selected, otherwise use URL
                    let imageUrl = formData.get('itemImageUrl') || null;
                    const imageFile = formData.get('itemImageFile');
                    
                    if (imageFile && imageFile.size > 0) {
                        // Upload the file first
                        try {
                            const uploadFormData = new FormData();
                            uploadFormData.append('image', imageFile);
                            
                            const token = getAuthToken();
                            const uploadResponse = await fetch(`${API_BASE_URL}/restaurants/${restaurantId}/menu/items/upload-image`, {
                                method: 'POST',
                                headers: {
                                    ...(token && { 'Authorization': `Bearer ${token}` })
                                },
                                body: uploadFormData
                            });

                            if (!uploadResponse.ok) {
                                const error = await uploadResponse.json().catch(() => ({ message: 'Upload failed' }));
                                throw new Error(error.message || 'Failed to upload image');
                            }

                            const uploadResult = await uploadResponse.json();
                            imageUrl = uploadResult.data.imageUrl;
                        } catch (error) {
                            console.error('Error uploading image:', error);
                            alert('Failed to upload image. Please try again.');
                            return;
                        }
                    }

                    const itemData = {
                        name: formData.get('itemName'),
                        description: formData.get('itemDescription') || null,
                        price: hasVariants ? null : parseFloat(formData.get('itemPrice')),
                        categoryId: categoryId,
                        imageUrl: imageUrl,
                        isAvailable: formData.get('itemAvailable') === 'on',
                        hasVariants,
                        variants
                    };

                    // Send data to backend
                    const response = await apiRequest(`/restaurants/${restaurantId}/menu/items`, {
                        method: 'POST',
                        body: JSON.stringify(itemData)
                    });

                    const createdItem = response.data;

                    // Show success message
                    alert(`Menu item "${itemData.name}" added successfully!`);

                    // Reset form after successful submission
                    resetForm();

                    // Redirect to menu management so the owner immediately sees the new item
                    const highlightId = createdItem?.id ? `?highlight=${createdItem.id}` : '';
                    window.location.href = `restaurant_menu_management.html${highlightId}`;
                    return;

                } catch (error) {
                    console.error('Error adding menu item:', error);
                    alert('Failed to add menu item. Please try again.');
                }
            } else {
                // Trigger browser validation
                addMenuForm.reportValidity();
            }
        });
    });
</script>
<script id="dhws-dataInjector" src="../../public/dhws-data-injector.js"></script>
</body>
</html>

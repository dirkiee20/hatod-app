<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Order Tracking - HATOD</title>
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/pages.css">
  
  
  
  </head>
    <style>
        html, body {
            overflow-x: hidden;
            position: relative;
        }
        body {
            margin: 0;
            padding: 0;
        }
        .content-wrapper {
            margin-top: calc(4rem + max(2rem, env(safe-area-inset-top))); /* Push content below fixed header */
            font-size: 0.78em; /* Base font size reduction by 22% */
        }
        /* Reduce font sizes */
        .content-wrapper .text-xs { font-size: calc(0.75rem * 0.78) !important; line-height: calc(1rem * 0.78) !important; }
        .content-wrapper .text-sm { font-size: calc(0.875rem * 0.78) !important; line-height: calc(1.25rem * 0.78) !important; }
        .content-wrapper .text-base { font-size: calc(1rem * 0.78) !important; line-height: calc(1.5rem * 0.78) !important; }
        .content-wrapper .text-lg { font-size: calc(1.125rem * 0.78) !important; line-height: calc(1.75rem * 0.78) !important; }
        .content-wrapper .text-xl { font-size: calc(1.25rem * 0.78) !important; line-height: calc(1.75rem * 0.78) !important; }
        .content-wrapper .text-2xl { font-size: calc(1.5rem * 0.78) !important; line-height: calc(2rem * 0.78) !important; }
        .content-wrapper .text-3xl { font-size: calc(1.875rem * 0.78) !important; line-height: calc(2.25rem * 0.78) !important; }
        /* Reduce spacing - padding */
        .content-wrapper .p-1 { padding: calc(0.25rem * 0.78) !important; }
        .content-wrapper .p-2 { padding: calc(0.5rem * 0.78) !important; }
        .content-wrapper .p-3 { padding: calc(0.75rem * 0.78) !important; }
        .content-wrapper .p-4 { padding: calc(1rem * 0.78) !important; }
        .content-wrapper .p-6 { padding: calc(1.5rem * 0.78) !important; }
        .content-wrapper .p-8 { padding: calc(2rem * 0.78) !important; }
        .content-wrapper .p-12 { padding: calc(3rem * 0.78) !important; }
        .content-wrapper .px-1 { padding-left: calc(0.25rem * 0.78) !important; padding-right: calc(0.25rem * 0.78) !important; }
        .content-wrapper .px-2 { padding-left: calc(0.5rem * 0.78) !important; padding-right: calc(0.5rem * 0.78) !important; }
        .content-wrapper .px-3 { padding-left: calc(0.75rem * 0.78) !important; padding-right: calc(0.75rem * 0.78) !important; }
        .content-wrapper .px-4 { padding-left: calc(1rem * 0.78) !important; padding-right: calc(1rem * 0.78) !important; }
        .content-wrapper .px-6 { padding-left: calc(1.5rem * 0.78) !important; padding-right: calc(1.5rem * 0.78) !important; }
        .content-wrapper .px-8 { padding-left: calc(2rem * 0.78) !important; padding-right: calc(2rem * 0.78) !important; }
        .content-wrapper .py-1 { padding-top: calc(0.25rem * 0.78) !important; padding-bottom: calc(0.25rem * 0.78) !important; }
        .content-wrapper .py-2 { padding-top: calc(0.5rem * 0.78) !important; padding-bottom: calc(0.5rem * 0.78) !important; }
        .content-wrapper .py-3 { padding-top: calc(0.75rem * 0.78) !important; padding-bottom: calc(0.75rem * 0.78) !important; }
        .content-wrapper .py-4 { padding-top: calc(1rem * 0.78) !important; padding-bottom: calc(1rem * 0.78) !important; }
        .content-wrapper .py-6 { padding-top: calc(1.5rem * 0.78) !important; padding-bottom: calc(1.5rem * 0.78) !important; }
        .content-wrapper .py-8 { padding-top: calc(2rem * 0.78) !important; padding-bottom: calc(2rem * 0.78) !important; }
        .content-wrapper .py-12 { padding-top: calc(3rem * 0.78) !important; padding-bottom: calc(3rem * 0.78) !important; }
        .content-wrapper .pt-2 { padding-top: calc(0.5rem * 0.78) !important; }
        .content-wrapper .pt-3 { padding-top: calc(0.75rem * 0.78) !important; }
        .content-wrapper .pt-4 { padding-top: calc(1rem * 0.78) !important; }
        .content-wrapper .pt-6 { padding-top: calc(1.5rem * 0.78) !important; }
        .content-wrapper .pt-8 { padding-top: calc(2rem * 0.78) !important; }
        .content-wrapper .pb-1 { padding-bottom: calc(0.25rem * 0.78) !important; }
        .content-wrapper .pb-3 { padding-bottom: calc(0.75rem * 0.78) !important; }
        .content-wrapper .pb-4 { padding-bottom: calc(1rem * 0.78) !important; }
        .content-wrapper .pb-6 { padding-bottom: calc(1.5rem * 0.78) !important; }
        .content-wrapper .pb-20 { padding-bottom: calc(5rem * 0.78) !important; }
        /* Reduce spacing - margin */
        .content-wrapper .mb-1 { margin-bottom: calc(0.25rem * 0.78) !important; }
        .content-wrapper .mb-2 { margin-bottom: calc(0.5rem * 0.78) !important; }
        .content-wrapper .mb-3 { margin-bottom: calc(0.75rem * 0.78) !important; }
        .content-wrapper .mb-4 { margin-bottom: calc(1rem * 0.78) !important; }
        .content-wrapper .mb-6 { margin-bottom: calc(1.5rem * 0.78) !important; }
        .content-wrapper .mb-8 { margin-bottom: calc(2rem * 0.78) !important; }
        .content-wrapper .mt-1 { margin-top: calc(0.25rem * 0.78) !important; }
        .content-wrapper .mt-2 { margin-top: calc(0.5rem * 0.78) !important; }
        .content-wrapper .mt-3 { margin-top: calc(0.75rem * 0.78) !important; }
        .content-wrapper .mt-4 { margin-top: calc(1rem * 0.78) !important; }
        .content-wrapper .mt-6 { margin-top: calc(1.5rem * 0.78) !important; }
        .content-wrapper .mt-8 { margin-top: calc(2rem * 0.78) !important; }
        .content-wrapper .mt-12 { margin-top: calc(3rem * 0.78) !important; }
        /* Reduce gaps */
        .content-wrapper .gap-1 { gap: calc(0.25rem * 0.78) !important; }
        .content-wrapper .gap-2 { gap: calc(0.5rem * 0.78) !important; }
        .content-wrapper .gap-3 { gap: calc(0.75rem * 0.78) !important; }
        .content-wrapper .gap-4 { gap: calc(1rem * 0.78) !important; }
        .content-wrapper .gap-6 { gap: calc(1.5rem * 0.78) !important; }
        .content-wrapper .gap-8 { gap: calc(2rem * 0.78) !important; }
        /* Reduce space-y utilities */
        .content-wrapper .space-y-1 > * + * { margin-top: calc(0.25rem * 0.78) !important; }
        .content-wrapper .space-y-2 > * + * { margin-top: calc(0.5rem * 0.78) !important; }
        .content-wrapper .space-y-3 > * + * { margin-top: calc(0.75rem * 0.78) !important; }
        .content-wrapper .space-y-4 > * + * { margin-top: calc(1rem * 0.78) !important; }
        .content-wrapper .space-y-6 > * + * { margin-top: calc(1.5rem * 0.78) !important; }
        .content-wrapper .space-y-8 > * + * { margin-top: calc(2rem * 0.78) !important; }
    </style>
<body class="bg-background min-h-screen">
    <!-- Header Navigation -->
    <header class="bg-surface shadow-card border-b border-border fixed top-0 left-0 right-0 z-50" style="padding-top: max(2rem, env(safe-area-inset-top));">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <img src="../../public/logos/app_logo.png" alt="HATOD Logo" class="w-10 h-10 mr-3 object-contain">
                    <h1 class="text-xl font-bold text-text-primary">HATOD</h1>
                </div>

                <!-- Navigation -->
                <nav class="hidden md:flex space-x-8">
                    <a href="../restaurants/restaurant_browse.html" class="text-text-secondary hover:text-primary transition-smooth">Browse</a>
                    <a href="shopping_cart.html" class="text-text-secondary hover:text-primary transition-smooth">Cart</a>
                    <a href="order_tracking.html" class="text-primary font-medium border-b-2 border-primary pb-1">Orders</a>
                    <a href="customer_profile.html" class="text-text-secondary hover:text-primary transition-smooth">Account</a>
                </nav>

                <!-- User Profile -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <img id="user-profile-img"
                             src="../../public/default-avatar.svg"
                             alt="Customer profile picture"
                             class="w-8 h-8 rounded-full object-cover"
                             onerror="this.src=window.DEFAULT_AVATAR_URL || '../../public/default-avatar.svg'; this.onerror=null;">
                        <span id="user-name" class="text-sm font-medium text-text-primary hidden sm:block">Loading...</span>
                    </div>
                </div>

            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-8">
        <div class="content-wrapper">
        <!-- Back Button -->
        <div class="mb-4">
            <button onclick="history.back()" class="flex items-center space-x-2 text-text-secondary hover:text-primary transition-smooth">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                <span class="text-sm font-medium">Back</span>
            </button>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
            <p class="mt-4 text-text-secondary">Loading order tracking...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden bg-surface rounded-lg p-12 shadow-card border border-border text-center">
            <svg class="w-16 h-16 text-red-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <h3 class="text-lg font-semibold text-text-primary mb-2">Failed to load order</h3>
            <p class="text-text-secondary mb-6" id="errorMessage">Unable to load order tracking. Please try again.</p>
            <a href="order_history.html" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary-600 transition-smooth btn-hover inline-block">
                Back to Orders
            </a>
        </div>

        <!-- Order Content -->
        <div id="orderContent" class="hidden">
            <!-- Page Header -->
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-text-primary mb-2">Track Your Order</h2>
                <p class="text-text-secondary">Real-time updates on your order progress</p>
            </div>

            <!-- Current Order Status Card -->
            <section class="mb-8">
            <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                    <div>
                        <h3 class="text-xl font-semibold text-text-primary mb-2">Order #<span id="order-id-display">Loading...</span></h3>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center">
                                <img id="restaurant-logo-header" 
                                     alt="Restaurant logo" 
                                     class="w-8 h-8 rounded-full object-cover mr-2"
                                     onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                                <span id="restaurant-name-header" class="text-text-primary font-medium">Loading...</span>
                            </div>
                            <span class="text-text-secondary">•</span>
                            <span id="order-time-header" class="text-text-secondary">Loading...</span>
                        </div>
                    </div>
                    <div class="mt-4 lg:mt-0">
                        <div id="order-status-badge" class="bg-warning-100 text-warning-600 px-4 py-2 rounded-lg text-center">
                            <div class="font-semibold">Loading...</div>
                            <div class="text-sm" id="eta-display">ETA: Calculating...</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Timeline -->
                <div class="relative">
                    <!-- Desktop Timeline -->
                    <div class="hidden md:block">
                        <div class="flex items-center justify-between relative">
                            <!-- Progress Line -->
                            <div class="absolute top-6 left-0 w-full h-1 bg-gray-200 rounded-full">
                                <div class="h-full bg-primary rounded-full transition-all duration-1000 order-progress-bar"></div>
                            </div>
                            
                            <!-- Timeline Steps -->
                            <div class="flex justify-between w-full relative z-10">
                                <!-- Step 1: Order Placed -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center mb-2">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm font-medium text-text-primary">Order Placed</div>
                                        <div class="text-xs text-text-secondary timeline-time-1">--</div>
                                    </div>
                                </div>

                                <!-- Step 2: Accepted -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-2">
                                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm font-medium text-text-secondary">Accepted</div>
                                        <div class="text-xs text-text-secondary timeline-time-2">--</div>
                                    </div>
                                </div>

                                <!-- Step 3: Preparing -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-2">
                                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm font-medium text-text-secondary">Preparing</div>
                                        <div class="text-xs text-text-secondary timeline-time-3">--</div>
                                    </div>
                                </div>

                                <!-- Step 4: Ready -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-2">
                                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm font-medium text-text-secondary">Ready</div>
                                        <div class="text-xs text-text-secondary timeline-time-4">--</div>
                                    </div>
                                </div>

                                <!-- Step 5: Out for Delivery -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-2">
                                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm font-medium text-text-secondary">Out for Delivery</div>
                                        <div class="text-xs text-text-secondary timeline-time-5">--</div>
                                    </div>
                                </div>

                                <!-- Step 6: Delivered -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-2">
                                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm font-medium text-text-secondary">Delivered</div>
                                        <div class="text-xs text-text-secondary timeline-time-6">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Timeline -->
                    <div class="md:hidden">
                        <div class="space-y-4">
                            <!-- Step 1: Order Placed -->
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-text-primary">Order Placed</div>
                                    <div class="text-xs text-text-secondary mobile-timeline-time-1">--</div>
                                </div>
                            </div>

                            <!-- Step 2: Accepted -->
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-text-secondary">Accepted by Restaurant</div>
                                    <div class="text-xs text-text-secondary mobile-timeline-time-2">--</div>
                                </div>
                            </div>

                            <!-- Step 3: Preparing -->
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-text-secondary">Preparing Your Order</div>
                                    <div class="text-xs text-text-secondary mobile-timeline-time-3">--</div>
                                </div>
                            </div>

                            <!-- Remaining steps (inactive) -->
                            <div class="flex items-center space-x-4 opacity-50">
                                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-text-secondary">Ready for Pickup</div>
                                    <div class="text-xs text-text-secondary">Order will be ready for delivery</div>
                                </div>
                            </div>

                            <div class="flex items-center space-x-4 opacity-50">
                                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-text-secondary">Out for Delivery</div>
                                    <div class="text-xs text-text-secondary">Driver is on the way to you</div>
                                </div>
                            </div>

                            <div class="flex items-center space-x-4 opacity-50">
                                <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm font-medium text-text-secondary">Delivered</div>
                                    <div class="text-xs text-text-secondary">Enjoy your meal!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Order Details and Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Order Details -->
            <div class="lg:col-span-2">
                <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                    <h3 class="text-lg font-semibold text-text-primary mb-4">Order Details</h3>
                    
                    <!-- Order Items -->
                    <div class="space-y-4 mb-6">
                        <!-- Order items will be loaded here -->
                    </div>

                    <!-- Order Summary -->
                    <div class="space-y-2 pt-4 border-t border-border">
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Subtotal</span>
                            <span class="text-text-primary">₱0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Delivery Fee</span>
                            <span class="text-text-primary">₱0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Tax</span>
                            <span class="text-text-primary">₱0.00</span>
                        </div>
                        <div class="flex justify-between font-semibold text-lg pt-2 border-t border-border">
                            <span class="text-text-primary">Total</span>
                            <span class="text-text-primary">₱0.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Restaurant Contact -->
            <div>
                <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                    <h3 class="text-lg font-semibold text-text-primary mb-4">Restaurant Contact</h3>
                    <div class="flex items-center space-x-3 mb-4">
                        <img id="restaurant-logo-contact" 
                             alt="Restaurant logo" 
                             class="w-12 h-12 rounded-full object-cover"
                             onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                        <div>
                            <div class="font-medium text-text-primary" id="restaurant-name-contact">--</div>
                            <div class="text-sm text-text-secondary" id="restaurant-phone-contact">--</div>
                        </div>
                    </div>
                    <button id="call-restaurant-btn" class="w-full bg-primary text-white py-2 px-4 rounded-lg hover:bg-primary-600 transition-smooth btn-hover">
                        <div class="flex items-center justify-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            <span>Call Restaurant</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Live Updates Section -->
        <section class="mb-8">
            <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-text-primary">Live Updates</h3>
                    <div class="flex items-center space-x-2 text-success">
                        <div class="w-2 h-2 bg-success rounded-full status-pulse"></div>
                        <span class="text-sm font-medium">Live</span>
                    </div>
                </div>
                <div id="live-updates-container" class="space-y-3">
                    <!-- Live updates will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Order History Link -->
        <section class="text-center">
            <div class="bg-surface rounded-lg p-6 shadow-card border border-border">
                <h3 class="text-lg font-semibold text-text-primary mb-2">Need to check another order?</h3>
                <p class="text-text-secondary mb-4">View all your past and current orders</p>
                <a href="order_history.html" class="inline-block bg-accent text-white px-6 py-2 rounded-lg hover:bg-accent-600 transition-smooth btn-hover">
                    View Order History
                </a>
            </div>
        </section>
        </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-surface border-t border-border mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col sm:flex-row justify-between items-center">
                <p class="text-text-secondary text-sm">© 2025 HATOD. All Rights Reserved.</p>
                <div class="flex items-center space-x-4 mt-4 sm:mt-0">
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Privacy Policy</a>
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Terms of Service</a>
                    <a href="javascript:void(0)" class="text-text-secondary hover:text-primary transition-smooth text-sm">Support</a>
                </div>
            </div>
        </div>
    </footer>
<script src="../../public/config.js"></script>
    <script>
        // API base URL (from config.js - automatically uses Railway URL in mobile apps)
        const API_BASE_URL = window.API_BASE_URL || 'http://localhost:4000/api';

    document.addEventListener('DOMContentLoaded', () => {
        loadUserProfile();
        loadOrderTracking();
    });

    async function loadUserProfile() {
        try {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            const payload = JSON.parse(atob(token.split('.')[1]));
            const userId = payload.sub;

            const response = await fetch(`${API_BASE_URL}/customers/${userId}/profile`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const result = await response.json();
                const profile = result.data;
                
                const userNameEl = document.getElementById('user-name');
                const userImgEl = document.getElementById('user-profile-img');
                
                if (userNameEl) {
                    userNameEl.textContent = profile.fullName || 'User';
                }
                if (userImgEl && profile.imageUrl) {
                    // Resolve image URL
                    const API_ORIGIN = API_BASE_URL.replace(/\/api$/, '');
                    const PLACEHOLDER_IMAGE = 'https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit/crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D';
                    
                    let imageUrl = profile.imageUrl;
                    if (imageUrl && !imageUrl.startsWith('http://') && !imageUrl.startsWith('https://')) {
                        const path = imageUrl.startsWith('/') ? imageUrl : `/${imageUrl}`;
                        imageUrl = `${API_ORIGIN}${path}`;
                    }
                    userImgEl.src = imageUrl || PLACEHOLDER_IMAGE;
                }
            }
        } catch (error) {
            console.error('Error loading user profile:', error);
        }
    }

    async function loadOrderTracking() {
        try {
            // Get order ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');

            if (!orderId) {
                // Silently redirect to order history if no orderId provided
                window.location.href = 'order_history.html';
                return;
            }

            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please log in to track your order');
                window.location.href = '../login.html';
                return;
            }

            // Fetch order details and status history
            const orderResponse = await fetch(`${API_BASE_URL}/orders/${orderId}`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            let statusHistoryResponse = null;
            try {
                statusHistoryResponse = await fetch(`${API_BASE_URL}/orders/${orderId}/history`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
            } catch (e) {
                // Status history is optional
                console.log('Status history not available');
            }

            if (!orderResponse.ok) {
                throw new Error('Failed to load order details');
            }

            const result = await orderResponse.json();
            const { order, items, delivery } = result.data;

            let statusHistory = [];
            if (statusHistoryResponse && statusHistoryResponse.ok) {
                const historyResult = await statusHistoryResponse.json();
                statusHistory = historyResult.data || [];
            }

            // Hide loading, show content
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('orderContent').classList.remove('hidden');

            // Update the page with real data
            await updateOrderTracking(order, items, delivery, statusHistory);

        } catch (error) {
            console.error('Error loading order tracking:', error);
            showError('Failed to load order details. Please try again.');
        }
    }

    function showError(message) {
        document.getElementById('loadingState').classList.add('hidden');
        document.getElementById('errorState').classList.remove('hidden');
        document.getElementById('errorMessage').textContent = message;
    }

    function calculateETA(order) {
        try {
            const orderDate = new Date(order.createdAt);
            let deliveryDate;
            
            // If estimatedDeliveryTime exists and is a valid timestamp, use it
            if (order.estimatedDeliveryTime) {
                deliveryDate = new Date(order.estimatedDeliveryTime);
                // Validate the date
                if (isNaN(deliveryDate.getTime())) {
                    throw new Error('Invalid estimated delivery time');
                }
            } else {
                // Default: add 30-40 minutes to order time (use 35 minutes as average)
                deliveryDate = new Date(orderDate.getTime() + (35 * 60 * 1000));
            }
            
            // Format as time (e.g., "9:00 PM")
            const timeStr = deliveryDate.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
            
            return `ETA: ${timeStr}`;
        } catch (error) {
            console.error('Error calculating ETA:', error);
            // Fallback: add 35 minutes to order time
            try {
                const orderDate = new Date(order.createdAt);
                const deliveryDate = new Date(orderDate.getTime() + (35 * 60 * 1000));
                const timeStr = deliveryDate.toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                });
                return `ETA: ${timeStr}`;
            } catch (fallbackError) {
                return 'ETA: Calculating...';
            }
        }
    }

    async function updateOrderTracking(order, items, delivery, statusHistory) {
        // Update order ID
        const orderIdElement = document.getElementById('order-id-display');
        if (orderIdElement) {
            orderIdElement.textContent = order.id.slice(-8).toUpperCase();
        }

        // Update restaurant info in header
        const restaurantLogo = document.getElementById('restaurant-logo-header');
        const restaurantName = document.getElementById('restaurant-name-header');
        const orderTimeHeader = document.getElementById('order-time-header');

        if (restaurantLogo) restaurantLogo.src = order.restaurantImageUrl || restaurantLogo.src;
        if (restaurantLogo) restaurantLogo.alt = `${order.restaurantName || 'Restaurant'} logo`;
        if (restaurantName) restaurantName.textContent = order.restaurantName || 'Restaurant';
        if (orderTimeHeader) {
            const orderDate = new Date(order.createdAt);
            const timeStr = orderDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            orderTimeHeader.textContent = `Placed at ${timeStr}`;
        }

        // Update status badge
        const statusElement = document.getElementById('order-status-badge');
        const statusText = order.status.charAt(0).toUpperCase() + order.status.slice(1).replace('_', ' ');
        const statusColors = {
            'pending': 'bg-yellow-100 text-yellow-600',
            'confirmed': 'bg-blue-100 text-blue-600',
            'preparing': 'bg-warning-100 text-warning-600',
            'ready': 'bg-purple-100 text-purple-600',
            'picked_up': 'bg-indigo-100 text-indigo-600',
            'delivered': 'bg-green-100 text-green-600',
            'cancelled': 'bg-red-100 text-red-600'
        };
        const statusColor = statusColors[order.status] || 'bg-gray-100 text-gray-600';
        
        if (statusElement) {
            statusElement.className = `${statusColor} px-4 py-2 rounded-lg text-center`;
            const etaText = calculateETA(order);
            statusElement.innerHTML = `
                <div class="font-semibold">${statusText}</div>
                <div class="text-sm">${etaText}</div>
            `;
        }

        // Update progress bar and timeline based on status
        updateProgressTimeline(order.status, order.createdAt);

        // Update order items
        const orderItemsContainer = document.querySelector('.space-y-4.mb-6');
        let itemsHtml = '';

        if (items && items.length > 0) {
            items.forEach(item => {
                const itemTotal = (parseFloat(item.unitPrice) || 0) * (parseInt(item.quantity) || 1);
                itemsHtml += `
                    <div class="flex items-center justify-between py-3 border-b border-border">
                        <div class="flex items-center space-x-3">
                            <img src="${item.imageUrl || 'https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'}"
                                 alt="${item.menuItemName || 'Menu item'}"
                                 class="w-12 h-12 rounded-lg object-cover"
                                 onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                            <div>
                                <div class="font-medium text-text-primary">${item.menuItemName || 'Menu item'}</div>
                                <div class="text-sm text-text-secondary">Quantity: ${item.quantity || 1}${item.specialInstructions ? ' • ' + item.specialInstructions : ''}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-medium text-text-primary">₱${itemTotal.toFixed(2)}</div>
                            <div class="text-sm text-text-secondary">₱${(parseFloat(item.unitPrice) || 0).toFixed(2)} each</div>
                        </div>
                    </div>
                `;
            });
        } else {
            itemsHtml = '<div class="text-text-secondary text-center py-4">No items found</div>';
        }

        if (orderItemsContainer) orderItemsContainer.innerHTML = itemsHtml;

        // Update order summary
        const subtotalElement = document.querySelector('.space-y-2.pt-4.border-t.border-border .flex.justify-between.text-sm:nth-child(1) span:last-child');
        const deliveryFeeElement = document.querySelector('.space-y-2.pt-4.border-t.border-border .flex.justify-between.text-sm:nth-child(2) span:last-child');
        const taxElement = document.querySelector('.space-y-2.pt-4.border-t.border-border .flex.justify-between.text-sm:nth-child(3) span:last-child');
        const totalElement = document.querySelector('.flex.justify-between.font-semibold.text-lg.pt-2.border-t.border-border span:last-child');

        if (subtotalElement) subtotalElement.textContent = `₱${(parseFloat(order.subtotal) || 0).toFixed(2)}`;
        if (deliveryFeeElement) deliveryFeeElement.textContent = `₱${(parseFloat(order.deliveryFee) || 0).toFixed(2)}`;
        if (taxElement) taxElement.textContent = `₱0.00`;
        if (totalElement) totalElement.textContent = `₱${(parseFloat(order.totalAmount) || 0).toFixed(2)}`;

        // Update restaurant contact
        await updateRestaurantContact(order, delivery);
        
        // Update live updates from status history
        updateLiveUpdates(statusHistory, order);
    }


    async function updateRestaurantContact(order, delivery) {
        try {
            const token = localStorage.getItem('authToken');
            
            // Update restaurant contact section
            const contactLogo = document.getElementById('restaurant-logo-contact');
            const contactName = document.getElementById('restaurant-name-contact');
            const contactPhone = document.getElementById('restaurant-phone-contact');
            
            if (contactLogo) {
                const API_ORIGIN = API_BASE_URL.replace(/\/api$/, '');
                let imageUrl = order.restaurantImageUrl;
                if (imageUrl && !imageUrl.startsWith('http://') && !imageUrl.startsWith('https://')) {
                    const path = imageUrl.startsWith('/') ? imageUrl : `/${imageUrl}`;
                    imageUrl = `${API_ORIGIN}${path}`;
                }
                contactLogo.src = imageUrl || contactLogo.src;
                contactLogo.alt = `${order.restaurantName || 'Restaurant'} logo`;
            }
            if (contactName) contactName.textContent = order.restaurantName || 'Restaurant';
            if (contactPhone) {
                // Display phone number if available
                contactPhone.textContent = order.restaurantPhone || 'Phone not available';
            }

            // Update call button
            const callButton = document.getElementById('call-restaurant-btn');
            if (callButton && order.restaurantPhone) {
                callButton.onclick = () => {
                    window.location.href = `tel:${order.restaurantPhone}`;
                };
            }
        } catch (error) {
            console.error('Error loading restaurant contact:', error);
        }
    }

    function updateLiveUpdates(statusHistory, order) {
        const updatesContainer = document.getElementById('live-updates-container');
        if (!updatesContainer) return;

        if (!statusHistory || statusHistory.length === 0) {
            // Create default updates from order status
            const defaultUpdates = [
                {
                    status: order.status,
                    note: `Order is ${order.status.replace('_', ' ')}`,
                    createdAt: order.createdAt
                }
            ];
            statusHistory = defaultUpdates;
        }

        // Sort by date (newest first)
        const sortedHistory = [...statusHistory].sort((a, b) => 
            new Date(b.createdAt) - new Date(a.createdAt)
        );

        let updatesHtml = '';
        const statusMessages = {
            'pending': 'Order placed successfully',
            'confirmed': 'Order accepted by restaurant',
            'preparing': 'Order is being prepared',
            'ready': 'Order is ready for pickup',
            'picked_up': 'Order is out for delivery',
            'delivered': 'Order has been delivered',
            'cancelled': 'Order has been cancelled'
        };

        const statusColors = {
            'pending': 'bg-primary',
            'confirmed': 'bg-primary',
            'preparing': 'bg-warning',
            'ready': 'bg-purple-500',
            'picked_up': 'bg-indigo-500',
            'delivered': 'bg-green-500',
            'cancelled': 'bg-red-500'
        };

        sortedHistory.forEach(event => {
            const status = event.status || order.status;
            const message = statusMessages[status] || `Order status: ${status}`;
            const note = event.note || '';
            const color = statusColors[status] || 'bg-gray-500';
            const date = new Date(event.createdAt || order.createdAt);
            const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

            updatesHtml += `
                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                    <div class="w-2 h-2 ${color} rounded-full mt-2 flex-shrink-0"></div>
                    <div>
                        <div class="text-sm font-medium text-text-primary">${message}</div>
                        <div class="text-xs text-text-secondary">${timeStr} ${dateStr}${note ? ' - ' + note : ''}</div>
                    </div>
                </div>
            `;
        });

        updatesContainer.innerHTML = updatesHtml || '<div class="text-text-secondary text-center py-4">No updates available</div>';
    }

    function updateProgressTimeline(status, createdAt) {
        const statusOrder = ['pending', 'confirmed', 'preparing', 'ready', 'picked_up', 'delivered'];
        const currentIndex = statusOrder.indexOf(status);
        
        // Calculate time differences for timeline
        const orderDate = new Date(createdAt);
        const now = new Date();
        const timeDiff = Math.floor((now - orderDate) / 1000 / 60); // minutes

        // Update progress bar width
        const progressBar = document.querySelector('.order-progress-bar');
        if (progressBar) {
            const progress = ((currentIndex + 1) / statusOrder.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Update step icons and colors (desktop)
        const steps = document.querySelectorAll('.hidden.md\\:block .flex.justify-between.w-full.relative.z-10 .flex.flex-col.items-center');
        const stepLabels = ['Order Placed', 'Accepted', 'Preparing', 'Ready', 'Out for Delivery', 'Delivered'];
        const stepStatuses = ['pending', 'confirmed', 'preparing', 'ready', 'picked_up', 'delivered'];
        
        steps.forEach((step, index) => {
            const icon = step.querySelector('div.w-12.h-12');
            const text = step.querySelector('div.text-sm.font-medium');
            const timeText = step.querySelector('div.text-xs.text-text-secondary');

            if (icon) {
                if (index <= currentIndex) {
                    // Completed or current step
                    if (index === currentIndex) {
                        // Current step - use warning color and pulse
                        icon.className = 'w-12 h-12 bg-warning rounded-full flex items-center justify-center mb-2 status-pulse';
                        if (text) {
                            text.className = 'text-sm font-medium text-warning';
                            text.textContent = stepLabels[index];
                        }
                        if (timeText) timeText.textContent = 'In progress';
                    } else {
                        // Completed step
                        icon.className = 'w-12 h-12 bg-primary rounded-full flex items-center justify-center mb-2';
                        if (text) {
                            text.className = 'text-sm font-medium text-text-primary';
                            text.textContent = stepLabels[index];
                        }
                        if (timeText) {
                            const stepTime = new Date(createdAt);
                            stepTime.setMinutes(stepTime.getMinutes() + (index * 2)); // Estimate
                            timeText.textContent = stepTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                        }
                    }
                } else {
                    // Future steps
                    icon.className = 'w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center mb-2';
                    if (text) {
                        text.className = 'text-sm font-medium text-text-secondary';
                        text.textContent = stepLabels[index];
                    }
                    if (timeText) timeText.textContent = 'Pending';
                }
            }
        });

        // Update mobile timeline
        const mobileSteps = document.querySelectorAll('.md\\:hidden .flex.items-center.space-x-4');
        mobileSteps.forEach((step, index) => {
            const icon = step.querySelector('div.w-10.h-10');
            const text = step.querySelector('div.text-sm.font-medium');

            if (icon) {
                if (index <= currentIndex) {
                    icon.className = 'w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0';
                    if (text) text.className = 'text-sm font-medium text-text-primary';
                } else {
                    icon.className = 'w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0';
                    if (text) text.className = 'text-sm font-medium text-text-secondary';
                }
            }
        });
    }
    </script>
    <script id="dhws-dataInjector" src="../../public/dhws-data-injector.js"></script>
</body>
</html>
